# Error Handler

В этом задании мы имитируем пример классического Go кода: функцию-обработчик, которая идет в БД, и в зависимости от
ответа выбирает стратегию обработки ошибок. Например в каких то случаях нам надо сделать retry, в каких то вернуть
ошибку выше, а в каких то проигнорировать ошибку.

## Задачи

### 1. Реализовать свою кастомную ошибку

В Go принято строить цепочку ошибок по уровням обработки в приложении, оборачивая одну ошибку в другую, по сути
выстраивая их в подобие стека. Это используется, чтобы иметь возможность на каждом из уровней обогащать ошибку какими-то
дополнительными данными, или как-то в дальнейшем использовать информацию об обернутой ошибке.

Ваша ошибка должна имитировать логику форматирования
из `fmt.Printf` ([примеры](https://pkg.go.dev/fmt#example-Printf)), т.е. принимать
строку формата и произвольное количество выводимых параметров, и возвращать отформатированную строку в `Error()`.
Помимо этого, она также должна дописывать в конец этой строки текст оборачиваемой ошибки.

В файле [your_error.go](./errors/your_error.go) для вашей ошибки уже определена структура `AdditionalMessageError` и
описана сигнатура конструктора:
он принимает вложенную ошибку `err`, строку формата вывода `format` и аргументы для форматированного вывода `args`.

Вам нужно:

1. Реализовать конструктор;
2. Реализовать конструктор;
3. Добавить методы, чтобы `*AdditionalMessageError` удовлетворял интерфейсу `error`;
4. Правильно написать логику печати ошибки, описанную выше в условии. Примеры как это должно выглядеть с дополнительным
   описанием лежат в файле [your_error_test.go](./errors/your_error_test.go).
5. Добавить методы, чтобы `*AdditionalMessageError` умел отдавать вложенную ошибку в _error chain_, как это сделать
   описано в документации в конце;

### 2. Добавить логику обработки кастомных ошибок в handler'е

В файле [handler.go](./handler.go) частично описана `UpdateUserBalance`, которая вызывает метод БД `UpdateBalance`.
Сейчас она просто возвращает ошибку как есть, но вам нужно добавить логику обработки различных типов ошибок.

В файле [errors.go](./errors/errors.go) определены три типа ошибок:

- `RetryableError` - ошибка, которая указывает на то, что операцию нужно повторить. У неё есть метод `RetryCount()`,
  который возвращает количество попыток, которые нужно сделать;
- `NotFoundError` - ошибка, которая означает, что объект не найден в БД;
- `AdditionalMessageError`, которую вы должны были дореализовать в предыдущем пункте.

Логика работы handler'а следующая:

1. Если метод `UpdateBalance` возвращает ошибку, у которой в chain'е есть `RetryableError`, то handler должен попытаться
   повторить операцию столько раз, сколько указано в методе `RetryCount()`. Если после всех попыток ошибка не исчезла,
   вернуть последнюю ошибку.
2. Если возвращается ошибка, у которой в chain'е есть `NotFoundError`, handler должен обернуть эту ошибку
   в `AdditionalMessageError` с произвольным дополнительным текстом ошибки и вернуть ее наверх.
3. Если возвращается ошибка, у которой в chain'е есть `AdditionalMessageError`, то просто возвращаем ее наверх.
4. Если возвращается любая другая ошибка, handler должен выкинуть панику. **Дисклеймер:** в хорошем коде так не
   делается, здесь мы это делаем чисто из учебных целей.
5. Если ошибки нет, вернуть nil.

**Важно:** мы ориентируемся не на сам тип ошибки, которую нам вернул `UpdateBalance`, а именно на ее error chain.

Примеры использования вашего handler'а описаны в файле [handler_test.go](./handler_test.go).

### 3. Ответить на вопросы по заданию

В файле [questions.md](./questions.md) напиши ответы на вопросы, связанные с заданием.

## Как запустить тесты

Для проверки вашего решения запустите тесты:

```bash
# Запуск тестов с подробным выводом
go test -v ./homeworks/hw1/handler/...
```

## Полезные ссылки

1. Все про error chain'ы и продвинутую обработку ошибок в Go: https://go.dev/blog/go1.13-errors#errors-in-go-113
2. Документация пакета fmt: https://pkg.go.dev/fmt#pkg-overview
3. Про паники: https://go.dev/blog/defer-panic-and-recover

